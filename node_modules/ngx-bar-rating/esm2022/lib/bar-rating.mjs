import { Component, Output, signal, computed, forwardRef, numberAttribute, booleanAttribute, input, model, contentChild, EventEmitter, ChangeDetectionStrategy } from '@angular/core';
import { NgTemplateOutlet } from '@angular/common';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { ActiveRating, FractionRating, InactiveRating } from './custom-rating';
import * as i0 from "@angular/core";
/** This allows support [(ngModel)] and ngControl. */
const RATING_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => BarRating),
    multi: true
};
/** This allows control required validation. */
const RATING_VALUE_VALIDATOR = {
    provide: NG_VALIDATORS,
    useExisting: forwardRef(() => BarRating),
    multi: true,
};
var BarRatingUnitState;
(function (BarRatingUnitState) {
    BarRatingUnitState["active"] = "active";
    BarRatingUnitState["inactive"] = "inactive";
    BarRatingUnitState["selected"] = "selected";
    BarRatingUnitState["fraction"] = "fraction";
})(BarRatingUnitState || (BarRatingUnitState = {}));
export class BarRating {
    constructor() {
        this.onChange = () => {
        };
        this.onTouched = () => {
        };
        this.UNITS = BarRatingUnitState;
        /** Current rating. Can be a decimal value like 3.14 */
        this.rate = model(5);
        /** Maximal rating that can be given using this widget. */
        this.max = input(5, { transform: numberAttribute });
        /** A flag indicating if rating can be updated. */
        this.readOnly = input(false, {
            transform: booleanAttribute,
            alias: 'readonly'
        });
        /** Set the theme */
        this.theme = input('default');
        /** Show rating title */
        this.showText = input(false, { transform: booleanAttribute });
        /** Replace rate value with a title */
        this.titles = input([]);
        /** A flag indicating if rating is required for form validation. */
        this.required = input(false, { transform: booleanAttribute });
        this.tabIndex = input(0, { transform: numberAttribute });
        this.hoveredIndex = signal(null);
        this.contexts = computed(() => {
            if (this.hoveredIndex()) {
                return Array.from({ length: this.max() }, (c, i) => {
                    if (this.hoveredIndex()) {
                        if (i + 1 <= this.hoveredIndex()) {
                            return BarRatingUnitState.active;
                        }
                        return BarRatingUnitState.inactive;
                    }
                });
            }
            return Array.from({ length: this.max() }, (c, i) => {
                if (i + 1 <= this.rate()) {
                    return BarRatingUnitState.selected;
                }
                if ((i + 1 === Math.round(this.rate()) && this.rate() % 1) >= 0.5) {
                    return BarRatingUnitState.fraction;
                }
                return BarRatingUnitState.inactive;
            });
        });
        this.ratingText = computed(() => {
            const value = this.hoveredIndex() || this.rate();
            return this.titles()[value] || value;
        });
        /**
         * A stream that forwards a bar rating click since clicks are not propagated
         */
        this.barClick = new EventEmitter();
        this.customActiveRating = contentChild(ActiveRating);
        this.customInActiveRating = contentChild(InactiveRating);
        this.customFractionRating = contentChild(FractionRating);
    }
    updateRating(value) {
        this.rate.set(value);
        this.onChange(value);
    }
    /**
     * This is the initial value set to the component
     */
    writeValue(value) {
        if (value !== null) {
            this.rate.set(value);
        }
    }
    validate(c) {
        return (this.required && !c.value) ? { required: true } : null;
    }
    registerOnChange(fn) {
        this.onChange = fn;
    }
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.4", ngImport: i0, type: BarRating, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.0.4", type: BarRating, isStandalone: true, selector: "bar-rating", inputs: { rate: { classPropertyName: "rate", publicName: "rate", isSignal: true, isRequired: false, transformFunction: null }, max: { classPropertyName: "max", publicName: "max", isSignal: true, isRequired: false, transformFunction: null }, readOnly: { classPropertyName: "readOnly", publicName: "readonly", isSignal: true, isRequired: false, transformFunction: null }, theme: { classPropertyName: "theme", publicName: "theme", isSignal: true, isRequired: false, transformFunction: null }, showText: { classPropertyName: "showText", publicName: "showText", isSignal: true, isRequired: false, transformFunction: null }, titles: { classPropertyName: "titles", publicName: "titles", isSignal: true, isRequired: false, transformFunction: null }, required: { classPropertyName: "required", publicName: "required", isSignal: true, isRequired: false, transformFunction: null }, tabIndex: { classPropertyName: "tabIndex", publicName: "tabIndex", isSignal: true, isRequired: false, transformFunction: null } }, outputs: { rate: "rateChange", barClick: "barClick" }, providers: [RATING_VALUE_ACCESSOR, RATING_VALUE_VALIDATOR], queries: [{ propertyName: "customActiveRating", first: true, predicate: ActiveRating, descendants: true, isSignal: true }, { propertyName: "customInActiveRating", first: true, predicate: InactiveRating, descendants: true, isSignal: true }, { propertyName: "customFractionRating", first: true, predicate: FractionRating, descendants: true, isSignal: true }], ngImport: i0, template: "<div class=\"br br-{{ customInActiveRating() ? '' : theme() }}\"\r\n     [class.br-readonly]=\"readOnly()\"\r\n     [class.br-disabled]=\"disabled\"\r\n     [attr.tabindex]=\"disabled || readOnly() ? -1 : tabIndex()\"\r\n     (focusout)=\"onTouched()\">\r\n\r\n  <div class=\"br-units\"\r\n       (mouseleave)=\"hoveredIndex.set(0)\">\r\n    @for (unit of contexts(); let i = $index; track i) {\r\n      <div class=\"br-unit\"\r\n           (click)=\"updateRating(i + 1); barClick.emit(i + 1)\"\r\n           (mouseenter)=\"hoveredIndex.set(i + 1)\">\r\n        @switch (unit) {\r\n          @case (UNITS.fraction) {\r\n            <ng-template [ngTemplateOutlet]=\"customFractionRating()?.template || fractionTemplate\"/>\r\n          }\r\n          @case (UNITS.inactive) {\r\n            <ng-template [ngTemplateOutlet]=\"customInActiveRating()?.template || inactiveTemplate\"/>\r\n          }\r\n          @default {\r\n            <ng-template [ngTemplateOutlet]=\"customActiveRating()?.template || activeTemplate\"/>\r\n          }\r\n        }\r\n      </div>\r\n    }\r\n  </div>\r\n\r\n  @if (showText()) {\r\n    <div class=\"br-text\">{{ ratingText() }}</div>\r\n  }\r\n</div>\r\n\r\n<ng-template #fractionTemplate>\r\n  <div class=\"br-unit-inner br-fraction\"></div>\r\n</ng-template>\r\n\r\n<ng-template #activeTemplate>\r\n  <div class=\"br-unit-inner br-active\"></div>\r\n</ng-template>\r\n\r\n<ng-template #inactiveTemplate>\r\n  <div class=\"br-unit-inner br-inactive\"></div>\r\n</ng-template>\r\n", styles: ["*{box-sizing:border-box}:host{--br-font-size: 16px;--br-gap: 0;--br-active-color: #EDB867;--br-inactive-color: #D2D2D2}.br{position:relative}.br-units{display:flex;flex-wrap:nowrap;gap:var(--br-gap)}.br-unit{font-size:var(--br-font-size);cursor:pointer;-webkit-font-smoothing:antialiased;text-rendering:auto}.br-unit-inner{position:relative}.br-readonly .br-unit,.br-disabled .br-unit{cursor:default;pointer-events:none}\n"], dependencies: [{ kind: "directive", type: NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.4", ngImport: i0, type: BarRating, decorators: [{
            type: Component,
            args: [{ standalone: true, selector: 'bar-rating', providers: [RATING_VALUE_ACCESSOR, RATING_VALUE_VALIDATOR], imports: [NgTemplateOutlet], changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"br br-{{ customInActiveRating() ? '' : theme() }}\"\r\n     [class.br-readonly]=\"readOnly()\"\r\n     [class.br-disabled]=\"disabled\"\r\n     [attr.tabindex]=\"disabled || readOnly() ? -1 : tabIndex()\"\r\n     (focusout)=\"onTouched()\">\r\n\r\n  <div class=\"br-units\"\r\n       (mouseleave)=\"hoveredIndex.set(0)\">\r\n    @for (unit of contexts(); let i = $index; track i) {\r\n      <div class=\"br-unit\"\r\n           (click)=\"updateRating(i + 1); barClick.emit(i + 1)\"\r\n           (mouseenter)=\"hoveredIndex.set(i + 1)\">\r\n        @switch (unit) {\r\n          @case (UNITS.fraction) {\r\n            <ng-template [ngTemplateOutlet]=\"customFractionRating()?.template || fractionTemplate\"/>\r\n          }\r\n          @case (UNITS.inactive) {\r\n            <ng-template [ngTemplateOutlet]=\"customInActiveRating()?.template || inactiveTemplate\"/>\r\n          }\r\n          @default {\r\n            <ng-template [ngTemplateOutlet]=\"customActiveRating()?.template || activeTemplate\"/>\r\n          }\r\n        }\r\n      </div>\r\n    }\r\n  </div>\r\n\r\n  @if (showText()) {\r\n    <div class=\"br-text\">{{ ratingText() }}</div>\r\n  }\r\n</div>\r\n\r\n<ng-template #fractionTemplate>\r\n  <div class=\"br-unit-inner br-fraction\"></div>\r\n</ng-template>\r\n\r\n<ng-template #activeTemplate>\r\n  <div class=\"br-unit-inner br-active\"></div>\r\n</ng-template>\r\n\r\n<ng-template #inactiveTemplate>\r\n  <div class=\"br-unit-inner br-inactive\"></div>\r\n</ng-template>\r\n", styles: ["*{box-sizing:border-box}:host{--br-font-size: 16px;--br-gap: 0;--br-active-color: #EDB867;--br-inactive-color: #D2D2D2}.br{position:relative}.br-units{display:flex;flex-wrap:nowrap;gap:var(--br-gap)}.br-unit{font-size:var(--br-font-size);cursor:pointer;-webkit-font-smoothing:antialiased;text-rendering:auto}.br-unit-inner{position:relative}.br-readonly .br-unit,.br-disabled .br-unit{cursor:default;pointer-events:none}\n"] }]
        }], propDecorators: { barClick: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFyLXJhdGluZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1iYXItcmF0aW5nL3NyYy9saWIvYmFyLXJhdGluZy50cyIsIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1iYXItcmF0aW5nL3NyYy9saWIvYmFyLXJhdGluZy5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsTUFBTSxFQUNOLE1BQU0sRUFDTixRQUFRLEVBQ1IsVUFBVSxFQUNWLGVBQWUsRUFDZixnQkFBZ0IsRUFDaEIsS0FBSyxFQUNMLEtBQUssRUFDTCxZQUFZLEVBQ1osWUFBWSxFQU9aLHVCQUF1QixFQUN4QixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNuRCxPQUFPLEVBQW1DLGFBQWEsRUFBRSxpQkFBaUIsRUFBc0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUN2SCxPQUFPLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBRSxjQUFjLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7QUFFL0UscURBQXFEO0FBQ3JELE1BQU0scUJBQXFCLEdBQWE7SUFDdEMsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQztJQUN4QyxLQUFLLEVBQUUsSUFBSTtDQUNaLENBQUM7QUFFRiwrQ0FBK0M7QUFDL0MsTUFBTSxzQkFBc0IsR0FBYTtJQUN2QyxPQUFPLEVBQUUsYUFBYTtJQUN0QixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQztJQUN4QyxLQUFLLEVBQUUsSUFBSTtDQUNaLENBQUM7QUFFRixJQUFLLGtCQUtKO0FBTEQsV0FBSyxrQkFBa0I7SUFDckIsdUNBQWlCLENBQUE7SUFDakIsMkNBQXFCLENBQUE7SUFDckIsMkNBQXFCLENBQUE7SUFDckIsMkNBQXFCLENBQUE7QUFDdkIsQ0FBQyxFQUxJLGtCQUFrQixLQUFsQixrQkFBa0IsUUFLdEI7QUFXRCxNQUFNLE9BQU8sU0FBUztJQVR0QjtRQVdFLGFBQVEsR0FBdUIsR0FBRyxFQUFFO1FBQ3BDLENBQUMsQ0FBQztRQUVGLGNBQVMsR0FBZ0IsR0FBRyxFQUFFO1FBQzlCLENBQUMsQ0FBQztRQUVPLFVBQUssR0FBRyxrQkFBa0IsQ0FBQztRQUlwQyx1REFBdUQ7UUFDdkQsU0FBSSxHQUF3QixLQUFLLENBQVMsQ0FBQyxDQUFDLENBQUM7UUFFN0MsMERBQTBEO1FBQzFELFFBQUcsR0FBc0QsS0FBSyxDQUEwQixDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLENBQUMsQ0FBQztRQUUzSCxrREFBa0Q7UUFDbEQsYUFBUSxHQUF3RCxLQUFLLENBQTRCLEtBQUssRUFBRTtZQUN0RyxTQUFTLEVBQUUsZ0JBQWdCO1lBQzNCLEtBQUssRUFBRSxVQUFVO1NBQ2xCLENBQUMsQ0FBQztRQUVILG9CQUFvQjtRQUNwQixVQUFLLEdBQXdCLEtBQUssQ0FBUyxTQUFTLENBQUMsQ0FBQztRQUV0RCx3QkFBd0I7UUFDeEIsYUFBUSxHQUF3RCxLQUFLLENBQTRCLEtBQUssRUFBRSxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUM7UUFFekksc0NBQXNDO1FBQ3RDLFdBQU0sR0FBMEIsS0FBSyxDQUFXLEVBQUUsQ0FBQyxDQUFDO1FBRXBELG1FQUFtRTtRQUNuRSxhQUFRLEdBQXdELEtBQUssQ0FBNEIsS0FBSyxFQUFFLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQztRQUV6SSxhQUFRLEdBQXNELEtBQUssQ0FBMEIsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBRSxDQUFDLENBQUM7UUFFaEksaUJBQVksR0FBMkIsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXBELGFBQVEsR0FBaUMsUUFBUSxDQUFDLEdBQUcsRUFBRTtZQUNyRCxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUUsRUFBRSxDQUFDO2dCQUN4QixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBUyxFQUFFLEVBQUU7b0JBQ3pELElBQUksSUFBSSxDQUFDLFlBQVksRUFBRSxFQUFFLENBQUM7d0JBQ3hCLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFLEVBQUUsQ0FBQzs0QkFDakMsT0FBTyxrQkFBa0IsQ0FBQyxNQUFNLENBQUM7d0JBQ25DLENBQUM7d0JBQ0QsT0FBTyxrQkFBa0IsQ0FBQyxRQUFRLENBQUM7b0JBQ3JDLENBQUM7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1lBQ0QsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQVMsRUFBRSxFQUFFO2dCQUN6RCxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUM7b0JBQ3pCLE9BQU8sa0JBQWtCLENBQUMsUUFBUSxDQUFDO2dCQUNyQyxDQUFDO2dCQUNELElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO29CQUNsRSxPQUFPLGtCQUFrQixDQUFDLFFBQVEsQ0FBQztnQkFDckMsQ0FBQztnQkFDRCxPQUFPLGtCQUFrQixDQUFDLFFBQVEsQ0FBQztZQUNyQyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsZUFBVSxHQUE0QixRQUFRLENBQUMsR0FBRyxFQUFFO1lBQ2xELE1BQU0sS0FBSyxHQUFvQixJQUFJLENBQUMsWUFBWSxFQUFFLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2xFLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztRQUVIOztXQUVHO1FBQ08sYUFBUSxHQUF5QixJQUFJLFlBQVksRUFBVSxDQUFDO1FBRXRFLHVCQUFrQixHQUF5QixZQUFZLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdEUseUJBQW9CLEdBQTJCLFlBQVksQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM1RSx5QkFBb0IsR0FBMkIsWUFBWSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0tBK0I3RTtJQTdCQyxZQUFZLENBQUMsS0FBYTtRQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7SUFFRDs7T0FFRztJQUNILFVBQVUsQ0FBQyxLQUFhO1FBQ3RCLElBQUksS0FBSyxLQUFLLElBQUksRUFBRSxDQUFDO1lBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3ZCLENBQUM7SUFDSCxDQUFDO0lBRUQsUUFBUSxDQUFDLENBQXFCO1FBQzVCLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2pFLENBQUM7SUFFRCxnQkFBZ0IsQ0FBQyxFQUFzQjtRQUNyQyxJQUFJLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQztJQUNyQixDQUFDO0lBRUQsaUJBQWlCLENBQUMsRUFBcUI7UUFDckMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQUVELGdCQUFnQixDQUFDLFVBQW1CO1FBQ2xDLElBQUksQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDO0lBQzdCLENBQUM7OEdBeEdVLFNBQVM7a0dBQVQsU0FBUywwbENBSlQsQ0FBQyxxQkFBcUIsRUFBRSxzQkFBc0IsQ0FBQywwRUE0RUYsWUFBWSx1R0FDUixjQUFjLHVHQUNkLGNBQWMsZ0VDaEk1RSwrK0NBMkNBLGdlRFFZLGdCQUFnQjs7MkZBR2YsU0FBUztrQkFUckIsU0FBUztpQ0FDSSxJQUFJLFlBQ04sWUFBWSxhQUdYLENBQUMscUJBQXFCLEVBQUUsc0JBQXNCLENBQUMsV0FDakQsQ0FBQyxnQkFBZ0IsQ0FBQyxtQkFDVix1QkFBdUIsQ0FBQyxNQUFNOzhCQXdFckMsUUFBUTtzQkFBakIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ29tcG9uZW50LFxyXG4gIE91dHB1dCxcclxuICBzaWduYWwsXHJcbiAgY29tcHV0ZWQsXHJcbiAgZm9yd2FyZFJlZixcclxuICBudW1iZXJBdHRyaWJ1dGUsXHJcbiAgYm9vbGVhbkF0dHJpYnV0ZSxcclxuICBpbnB1dCxcclxuICBtb2RlbCxcclxuICBjb250ZW50Q2hpbGQsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIFNpZ25hbCxcclxuICBQcm92aWRlcixcclxuICBJbnB1dFNpZ25hbCxcclxuICBNb2RlbFNpZ25hbCxcclxuICBXcml0YWJsZVNpZ25hbCxcclxuICBJbnB1dFNpZ25hbFdpdGhUcmFuc2Zvcm0sXHJcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3lcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTmdUZW1wbGF0ZU91dGxldCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBWYWxpZGF0b3IsIE5HX1ZBTElEQVRPUlMsIE5HX1ZBTFVFX0FDQ0VTU09SLCBVbnR5cGVkRm9ybUNvbnRyb2wgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEFjdGl2ZVJhdGluZywgRnJhY3Rpb25SYXRpbmcsIEluYWN0aXZlUmF0aW5nIH0gZnJvbSAnLi9jdXN0b20tcmF0aW5nJztcclxuXHJcbi8qKiBUaGlzIGFsbG93cyBzdXBwb3J0IFsobmdNb2RlbCldIGFuZCBuZ0NvbnRyb2wuICovXHJcbmNvbnN0IFJBVElOR19WQUxVRV9BQ0NFU1NPUjogUHJvdmlkZXIgPSB7XHJcbiAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gQmFyUmF0aW5nKSxcclxuICBtdWx0aTogdHJ1ZVxyXG59O1xyXG5cclxuLyoqIFRoaXMgYWxsb3dzIGNvbnRyb2wgcmVxdWlyZWQgdmFsaWRhdGlvbi4gKi9cclxuY29uc3QgUkFUSU5HX1ZBTFVFX1ZBTElEQVRPUjogUHJvdmlkZXIgPSB7XHJcbiAgcHJvdmlkZTogTkdfVkFMSURBVE9SUyxcclxuICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBCYXJSYXRpbmcpLFxyXG4gIG11bHRpOiB0cnVlLFxyXG59O1xyXG5cclxuZW51bSBCYXJSYXRpbmdVbml0U3RhdGUge1xyXG4gIGFjdGl2ZSA9ICdhY3RpdmUnLFxyXG4gIGluYWN0aXZlID0gJ2luYWN0aXZlJyxcclxuICBzZWxlY3RlZCA9ICdzZWxlY3RlZCcsXHJcbiAgZnJhY3Rpb24gPSAnZnJhY3Rpb24nXHJcbn1cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHN0YW5kYWxvbmU6IHRydWUsXHJcbiAgc2VsZWN0b3I6ICdiYXItcmF0aW5nJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vYmFyLXJhdGluZy5odG1sJyxcclxuICBzdHlsZVVybDogJy4vYmFyLXJhdGluZy5zY3NzJyxcclxuICBwcm92aWRlcnM6IFtSQVRJTkdfVkFMVUVfQUNDRVNTT1IsIFJBVElOR19WQUxVRV9WQUxJREFUT1JdLFxyXG4gIGltcG9ydHM6IFtOZ1RlbXBsYXRlT3V0bGV0XSxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQmFyUmF0aW5nIGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIFZhbGlkYXRvciB7XHJcblxyXG4gIG9uQ2hhbmdlOiBPbkNoYW5nZUZuPG51bWJlcj4gPSAoKSA9PiB7XHJcbiAgfTtcclxuXHJcbiAgb25Ub3VjaGVkOiBPblRvdWNoZWRGbiA9ICgpID0+IHtcclxuICB9O1xyXG5cclxuICByZWFkb25seSBVTklUUyA9IEJhclJhdGluZ1VuaXRTdGF0ZTtcclxuXHJcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XHJcblxyXG4gIC8qKiBDdXJyZW50IHJhdGluZy4gQ2FuIGJlIGEgZGVjaW1hbCB2YWx1ZSBsaWtlIDMuMTQgKi9cclxuICByYXRlOiBNb2RlbFNpZ25hbDxudW1iZXI+ID0gbW9kZWw8bnVtYmVyPig1KTtcclxuXHJcbiAgLyoqIE1heGltYWwgcmF0aW5nIHRoYXQgY2FuIGJlIGdpdmVuIHVzaW5nIHRoaXMgd2lkZ2V0LiAqL1xyXG4gIG1heDogSW5wdXRTaWduYWxXaXRoVHJhbnNmb3JtPG51bWJlciwgbnVtYmVyIHwgc3RyaW5nPiA9IGlucHV0PG51bWJlciwgc3RyaW5nIHwgbnVtYmVyPig1LCB7IHRyYW5zZm9ybTogbnVtYmVyQXR0cmlidXRlIH0pO1xyXG5cclxuICAvKiogQSBmbGFnIGluZGljYXRpbmcgaWYgcmF0aW5nIGNhbiBiZSB1cGRhdGVkLiAqL1xyXG4gIHJlYWRPbmx5OiBJbnB1dFNpZ25hbFdpdGhUcmFuc2Zvcm08Ym9vbGVhbiwgc3RyaW5nIHwgYm9vbGVhbj4gPSBpbnB1dDxib29sZWFuLCBzdHJpbmcgfCBib29sZWFuPihmYWxzZSwge1xyXG4gICAgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlLFxyXG4gICAgYWxpYXM6ICdyZWFkb25seSdcclxuICB9KTtcclxuXHJcbiAgLyoqIFNldCB0aGUgdGhlbWUgKi9cclxuICB0aGVtZTogSW5wdXRTaWduYWw8c3RyaW5nPiA9IGlucHV0PHN0cmluZz4oJ2RlZmF1bHQnKTtcclxuXHJcbiAgLyoqIFNob3cgcmF0aW5nIHRpdGxlICovXHJcbiAgc2hvd1RleHQ6IElucHV0U2lnbmFsV2l0aFRyYW5zZm9ybTxib29sZWFuLCBzdHJpbmcgfCBib29sZWFuPiA9IGlucHV0PGJvb2xlYW4sIHN0cmluZyB8IGJvb2xlYW4+KGZhbHNlLCB7IHRyYW5zZm9ybTogYm9vbGVhbkF0dHJpYnV0ZSB9KTtcclxuXHJcbiAgLyoqIFJlcGxhY2UgcmF0ZSB2YWx1ZSB3aXRoIGEgdGl0bGUgKi9cclxuICB0aXRsZXM6IElucHV0U2lnbmFsPHN0cmluZ1tdPiA9IGlucHV0PHN0cmluZ1tdPihbXSk7XHJcblxyXG4gIC8qKiBBIGZsYWcgaW5kaWNhdGluZyBpZiByYXRpbmcgaXMgcmVxdWlyZWQgZm9yIGZvcm0gdmFsaWRhdGlvbi4gKi9cclxuICByZXF1aXJlZDogSW5wdXRTaWduYWxXaXRoVHJhbnNmb3JtPGJvb2xlYW4sIHN0cmluZyB8IGJvb2xlYW4+ID0gaW5wdXQ8Ym9vbGVhbiwgc3RyaW5nIHwgYm9vbGVhbj4oZmFsc2UsIHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pO1xyXG5cclxuICB0YWJJbmRleDogSW5wdXRTaWduYWxXaXRoVHJhbnNmb3JtPG51bWJlciwgbnVtYmVyIHwgc3RyaW5nPiA9IGlucHV0PG51bWJlciwgc3RyaW5nIHwgbnVtYmVyPigwLCB7IHRyYW5zZm9ybTogbnVtYmVyQXR0cmlidXRlIH0pO1xyXG5cclxuICBob3ZlcmVkSW5kZXg6IFdyaXRhYmxlU2lnbmFsPG51bWJlcj4gPSBzaWduYWwobnVsbCk7XHJcblxyXG4gIGNvbnRleHRzOiBTaWduYWw8QmFyUmF0aW5nVW5pdFN0YXRlW10+ID0gY29tcHV0ZWQoKCkgPT4ge1xyXG4gICAgaWYgKHRoaXMuaG92ZXJlZEluZGV4KCkpIHtcclxuICAgICAgcmV0dXJuIEFycmF5LmZyb20oeyBsZW5ndGg6IHRoaXMubWF4KCkgfSwgKGMsIGk6IG51bWJlcikgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmhvdmVyZWRJbmRleCgpKSB7XHJcbiAgICAgICAgICBpZiAoaSArIDEgPD0gdGhpcy5ob3ZlcmVkSW5kZXgoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gQmFyUmF0aW5nVW5pdFN0YXRlLmFjdGl2ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBCYXJSYXRpbmdVbml0U3RhdGUuaW5hY3RpdmU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBBcnJheS5mcm9tKHsgbGVuZ3RoOiB0aGlzLm1heCgpIH0sIChjLCBpOiBudW1iZXIpID0+IHtcclxuICAgICAgaWYgKGkgKyAxIDw9IHRoaXMucmF0ZSgpKSB7XHJcbiAgICAgICAgcmV0dXJuIEJhclJhdGluZ1VuaXRTdGF0ZS5zZWxlY3RlZDtcclxuICAgICAgfVxyXG4gICAgICBpZiAoKGkgKyAxID09PSBNYXRoLnJvdW5kKHRoaXMucmF0ZSgpKSAmJiB0aGlzLnJhdGUoKSAlIDEpID49IDAuNSkge1xyXG4gICAgICAgIHJldHVybiBCYXJSYXRpbmdVbml0U3RhdGUuZnJhY3Rpb247XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIEJhclJhdGluZ1VuaXRTdGF0ZS5pbmFjdGl2ZTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICByYXRpbmdUZXh0OiBTaWduYWw8c3RyaW5nIHwgbnVtYmVyPiA9IGNvbXB1dGVkKCgpID0+IHtcclxuICAgIGNvbnN0IHZhbHVlOiBzdHJpbmcgfCBudW1iZXIgPSB0aGlzLmhvdmVyZWRJbmRleCgpIHx8IHRoaXMucmF0ZSgpO1xyXG4gICAgcmV0dXJuIHRoaXMudGl0bGVzKClbdmFsdWVdIHx8IHZhbHVlO1xyXG4gIH0pO1xyXG5cclxuICAvKipcclxuICAgKiBBIHN0cmVhbSB0aGF0IGZvcndhcmRzIGEgYmFyIHJhdGluZyBjbGljayBzaW5jZSBjbGlja3MgYXJlIG5vdCBwcm9wYWdhdGVkXHJcbiAgICovXHJcbiAgQE91dHB1dCgpIGJhckNsaWNrOiBFdmVudEVtaXR0ZXI8bnVtYmVyPiA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xyXG5cclxuICBjdXN0b21BY3RpdmVSYXRpbmc6IFNpZ25hbDxBY3RpdmVSYXRpbmc+ID0gY29udGVudENoaWxkKEFjdGl2ZVJhdGluZyk7XHJcbiAgY3VzdG9tSW5BY3RpdmVSYXRpbmc6IFNpZ25hbDxJbmFjdGl2ZVJhdGluZz4gPSBjb250ZW50Q2hpbGQoSW5hY3RpdmVSYXRpbmcpO1xyXG4gIGN1c3RvbUZyYWN0aW9uUmF0aW5nOiBTaWduYWw8RnJhY3Rpb25SYXRpbmc+ID0gY29udGVudENoaWxkKEZyYWN0aW9uUmF0aW5nKTtcclxuXHJcbiAgdXBkYXRlUmF0aW5nKHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIHRoaXMucmF0ZS5zZXQodmFsdWUpO1xyXG4gICAgdGhpcy5vbkNoYW5nZSh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGlzIHRoZSBpbml0aWFsIHZhbHVlIHNldCB0byB0aGUgY29tcG9uZW50XHJcbiAgICovXHJcbiAgd3JpdGVWYWx1ZSh2YWx1ZTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICBpZiAodmFsdWUgIT09IG51bGwpIHtcclxuICAgICAgdGhpcy5yYXRlLnNldCh2YWx1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB2YWxpZGF0ZShjOiBVbnR5cGVkRm9ybUNvbnRyb2wpOiB7IHJlcXVpcmVkOiBib29sZWFuIH0gfCBudWxsIHtcclxuICAgIHJldHVybiAodGhpcy5yZXF1aXJlZCAmJiAhYy52YWx1ZSkgPyB7IHJlcXVpcmVkOiB0cnVlIH0gOiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogT25DaGFuZ2VGbjxudW1iZXI+KTogdm9pZCB7XHJcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XHJcbiAgfVxyXG5cclxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogKCkgPT4gT25Ub3VjaGVkRm4pOiB2b2lkIHtcclxuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XHJcbiAgfVxyXG5cclxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xyXG4gIH1cclxufVxyXG5cclxudHlwZSBPbkNoYW5nZUZuPFQ+ID0gKHZhbHVlOiBUKSA9PiB2b2lkO1xyXG50eXBlIE9uVG91Y2hlZEZuID0gKCkgPT4gdm9pZDtcclxuIiwiPGRpdiBjbGFzcz1cImJyIGJyLXt7IGN1c3RvbUluQWN0aXZlUmF0aW5nKCkgPyAnJyA6IHRoZW1lKCkgfX1cIlxyXG4gICAgIFtjbGFzcy5ici1yZWFkb25seV09XCJyZWFkT25seSgpXCJcclxuICAgICBbY2xhc3MuYnItZGlzYWJsZWRdPVwiZGlzYWJsZWRcIlxyXG4gICAgIFthdHRyLnRhYmluZGV4XT1cImRpc2FibGVkIHx8IHJlYWRPbmx5KCkgPyAtMSA6IHRhYkluZGV4KClcIlxyXG4gICAgIChmb2N1c291dCk9XCJvblRvdWNoZWQoKVwiPlxyXG5cclxuICA8ZGl2IGNsYXNzPVwiYnItdW5pdHNcIlxyXG4gICAgICAgKG1vdXNlbGVhdmUpPVwiaG92ZXJlZEluZGV4LnNldCgwKVwiPlxyXG4gICAgQGZvciAodW5pdCBvZiBjb250ZXh0cygpOyBsZXQgaSA9ICRpbmRleDsgdHJhY2sgaSkge1xyXG4gICAgICA8ZGl2IGNsYXNzPVwiYnItdW5pdFwiXHJcbiAgICAgICAgICAgKGNsaWNrKT1cInVwZGF0ZVJhdGluZyhpICsgMSk7IGJhckNsaWNrLmVtaXQoaSArIDEpXCJcclxuICAgICAgICAgICAobW91c2VlbnRlcik9XCJob3ZlcmVkSW5kZXguc2V0KGkgKyAxKVwiPlxyXG4gICAgICAgIEBzd2l0Y2ggKHVuaXQpIHtcclxuICAgICAgICAgIEBjYXNlIChVTklUUy5mcmFjdGlvbikge1xyXG4gICAgICAgICAgICA8bmctdGVtcGxhdGUgW25nVGVtcGxhdGVPdXRsZXRdPVwiY3VzdG9tRnJhY3Rpb25SYXRpbmcoKT8udGVtcGxhdGUgfHwgZnJhY3Rpb25UZW1wbGF0ZVwiLz5cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIEBjYXNlIChVTklUUy5pbmFjdGl2ZSkge1xyXG4gICAgICAgICAgICA8bmctdGVtcGxhdGUgW25nVGVtcGxhdGVPdXRsZXRdPVwiY3VzdG9tSW5BY3RpdmVSYXRpbmcoKT8udGVtcGxhdGUgfHwgaW5hY3RpdmVUZW1wbGF0ZVwiLz5cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIEBkZWZhdWx0IHtcclxuICAgICAgICAgICAgPG5nLXRlbXBsYXRlIFtuZ1RlbXBsYXRlT3V0bGV0XT1cImN1c3RvbUFjdGl2ZVJhdGluZygpPy50ZW1wbGF0ZSB8fCBhY3RpdmVUZW1wbGF0ZVwiLz5cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgfVxyXG4gIDwvZGl2PlxyXG5cclxuICBAaWYgKHNob3dUZXh0KCkpIHtcclxuICAgIDxkaXYgY2xhc3M9XCJici10ZXh0XCI+e3sgcmF0aW5nVGV4dCgpIH19PC9kaXY+XHJcbiAgfVxyXG48L2Rpdj5cclxuXHJcbjxuZy10ZW1wbGF0ZSAjZnJhY3Rpb25UZW1wbGF0ZT5cclxuICA8ZGl2IGNsYXNzPVwiYnItdW5pdC1pbm5lciBici1mcmFjdGlvblwiPjwvZGl2PlxyXG48L25nLXRlbXBsYXRlPlxyXG5cclxuPG5nLXRlbXBsYXRlICNhY3RpdmVUZW1wbGF0ZT5cclxuICA8ZGl2IGNsYXNzPVwiYnItdW5pdC1pbm5lciBici1hY3RpdmVcIj48L2Rpdj5cclxuPC9uZy10ZW1wbGF0ZT5cclxuXHJcbjxuZy10ZW1wbGF0ZSAjaW5hY3RpdmVUZW1wbGF0ZT5cclxuICA8ZGl2IGNsYXNzPVwiYnItdW5pdC1pbm5lciBici1pbmFjdGl2ZVwiPjwvZGl2PlxyXG48L25nLXRlbXBsYXRlPlxyXG4iXX0=